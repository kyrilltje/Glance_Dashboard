
# =======================
# Games PAGE
# =======================
  - name: Games
    columns:

      # -----------------------
      # SMALL COLUMN
      # -----------------------
      - size: small
        widgets:

          # https://github.com/glanceapp/community-widgets/blob/main/widgets/steam-top-sellers/README.md
          - type: custom-api
            title: Steam Top Sellers
            cache: 12h
            url: https://store.steampowered.com/api/featuredcategories?cc=nl
            template: |
              <ul class="list list-gap-10 collapsible-contain">
                  {{ $count := 0 }}
                  {{ range .JSON.Array "top_sellers.items" }}
                  {{ if and (lt $count 6) (ne (.String "name") "Steam Deck") }}
                  <li style="display: flex; align-items: center; gap: 1rem;">
                      <img src="{{ .String "small_capsule_image" }}" alt="{{ .String "name" }}"
                          style="width: 120px; height: auto; border-radius: 4px; flex-shrink: 0;">
                      <div style="min-width: 0;">
                          <a class="size-h4 color-highlight text-truncate" style="display: block;"
                              href="https://store.steampowered.com/app/{{ .Int "id" }}/">
                              {{ .String "name" }}
                          </a>
                          <ul class="list-horizontal-text">
                              <li>{{ div (.Int "final_price" | toFloat) 100 | printf "€%.2f" }}</li>
                              {{ $discount := .Int "discount_percent" }}
                              {{ if gt $discount 0 }}
                              <li{{ if ge $discount 40 }} class="color-positive"{{ end }}>
                                  {{ $discount }}% off
                              </li>
                              {{ end }}
                          </ul>
                      </div>
                  </li>
                  {{ $count = add $count 1 }}
                  {{ end }}
                  {{ end }}
              </ul>


          - type: custom-api
            title: Games in Sale
            cache: 12h
            url: https://store.steampowered.com/api/featuredcategories?cc=nl
            template: |
              <ul class="list list-gap-10 collapsible-contain">
                  {{ $count := 0 }}
                  {{ range .JSON.Array "specials.items" }}
                  {{ if and (lt $count 6) (ne (.String "name") "Steam Deck") }}
                  <li style="display: flex; align-items: center; gap: 1rem;">
                      <img src="{{ .String "small_capsule_image" }}" alt="{{ .String "name" }}"
                          style="width: 120px; height: auto; border-radius: 4px; flex-shrink: 0;">
                      <div style="min-width: 0;">
                          <a class="size-h4 color-highlight text-truncate" style="display: block;"
                              href="https://store.steampowered.com/app/{{ .Int "id" }}/">
                              {{ .String "name" }}
                          </a>
                          <ul class="list-horizontal-text">
                              <li>{{ div (.Int "final_price" | toFloat) 100 | printf "€%.2f" }}</li>
                              {{ $discount := .Int "discount_percent" }}
                              {{ if gt $discount 0 }}
                              <li{{ if ge $discount 40 }} class="color-positive"{{ end }}>
                                  {{ $discount }}% off
                              </li>
                              {{ end }}
                          </ul>
                      </div>
                  </li>
                  {{ $count = add $count 1 }}
                  {{ end }}
                  {{ end }}
              </ul>


      # -----------------------
      # FULL COLUMN
      # -----------------------
      - size: full
        widgets:

          # https://github.com/glanceapp/community-widgets/blob/main/widgets/steam-recently-played-games/README.md

          - type: custom-api
            title: Recently Played Games
            cache: 1h
            url: http://api.steampowered.com/IPlayerService/GetRecentlyPlayedGames/v0001/?key=${STEAM_API_KEY}&steamid=${STEAM_USER}&format=json
            template: |
              <div>
                {{ if eq .Response.StatusCode 200 }}
                  {{ $games := .JSON.Array "response.games" }}
                  {{ if gt (len $games) 0 }}
                    <ul class="list list-gap-10 collapsible-container" data-collapse-after="5">
                      {{ range $games }}
                        <li style="display: flex; align-items: center;">
                          <a href="https://store.steampowered.com/app/{{ .Int "appid" }}" target="_blank">
                            <img
                              src="http://media.steampowered.com/steamcommunity/public/images/apps/{{ .Int "appid" }}/{{ .String "img_icon_url" }}.jpg"
                              alt="{{ .String "name" }}"
                              style="width: 32px; border-radius: var(--border-radius); margin-right: 10px;">
                          </a>
                          <div>
                            <a
                              href="https://store.steampowered.com/app/{{ .Int "appid" }}"
                              class="size-base color-primary"
                              target="_blank"
                            >
                              {{ .String "name" }}
                            </a>
                            <br>
                            <span class="size-h5 color-subdue">
                              Last 2 weeks: 
                              {{ if gt (toFloat (.Int "playtime_2weeks")) 60.0 }}
                                {{ printf "%.2f hrs" (div (toFloat (.Int "playtime_2weeks")) 60.0) }}
                              {{ else }}
                                {{ .Int "playtime_2weeks" }} mins
                              {{ end }}
                            </span>
                          </div>
                        </li>
                      {{ end }}
                    </ul>
                  {{ else }}
                    <p class="color-negative">No recently played games found.</p>
                  {{ end }}
                {{ else }}
                  <p class="color-negative">An unexpected error occurred. Please try again later.</p>
                {{ end }}
              </div> 
            
          # https://github.com/glanceapp/glance/blob/main/docs/configuration.md#reddit
          - type: group
            define: &shared-properties
                type: reddit
                show-thumbnails: true
                collapse-after: 5
            widgets:
              - subreddit: factorio
                <<: *shared-properties
              - subreddit: StardewValley
                <<: *shared-properties
              - subreddit: gamingnews
                <<: *shared-properties
              - subreddit: games
                <<: *shared-properties
              - subreddit: pcgaming
                <<: *shared-properties


      # -----------------------
      # SMALL COLUMN
      # -----------------------

      - size: small
        widgets:

          # https://github.com/glanceapp/community-widgets/blob/main/widgets/steam-user/README.md

          - type: custom-api
            title: Steam User
            cache: 1h
            url: https://api.steampowered.com/ISteamUser/GetPlayerSummaries/v0002/?key=${STEAM_API_KEY}&steamids=${STEAM_USER}
            template: |
              <div class="steam-user-stats" style="display: flex; align-items: flex-start;">
                {{ $players := .JSON.Array "response.players" }}
                {{ if gt (len $players) 0 }}
                  {{ $player := index $players 0 }}
                  <div style="flex-shrink: 0; margin-right: 1em; display: flex; flex-direction: column; align-items: center;">
                    <a href="{{ $player.String "profileurl" }}"><img src="{{ $player.String "avatarmedium" }}" alt="Avatar" style="border-radius: var(--border-radius);"></a>
                  </div>
                  <div>
                    <h2 class="size-h3 color-primary">{{ $player.String "personaname" }}</h2>
                    <p>Status: 
                      {{ $status := $player.Int "personastate" }}
                      {{ if eq $status 0 }}<span class="color-negative">Offline</span>{{ end }}
                      {{ if eq $status 1 }}<span class="color-positive">Online</span>{{ end }}
                      {{ if eq $status 2 }}<span class="color-highlight">Busy</span>{{ end }}
                      {{ if eq $status 3 }}<span class="color-subdue">Away</span>{{ end }}
                      {{ if eq $status 4 }}<span class="color-subdue">Snooze</span>{{ end }}
                      {{ if eq $status 5 }}<span class="color-primary">Looking to trade</span>{{ end }}
                      {{ if eq $status 6 }}<span class="color-primary">Looking to play</span>{{ end }}
                    </p>
                    <p>Last Logoff: <span class="color-subdue" data-dynamic-relative-time="{{ $player.Int "lastlogoff" }}"></span></p>
                    <p>Account Created: <span class="color-subdue" data-dynamic-relative-time="{{ $player.Int "timecreated" }}"></span></p>
                    <p>Country: <span class="color-subdue">{{ $player.String "loccountrycode" }}</span></p>
                  </div>
                {{ else }}
                  <p class="color-negative">No player data found.</p>
                {{ end }}
              </div>

          # https://github.com/glanceapp/glance/blob/main/docs/configuration.md#twitch-channels

          - type: twitch-top-games
            hide-header: true          
            limit: 20
            collapse-after: 5
            exclude:
              - just-chatting
              - pools-hot-tubs-and-beaches
              - music
              - art
              - asmr



          - type: twitch-channels
            channels:
              - jembawls
              - giantwaffle
              - asmongold
              - cohhcarnage
              - j_blow
              - xQc     
