# =======================
# Hosting PAGE
# =======================
  - name: Hosting
    columns:

      # -----------------------
      # SMALL COLUMN
      # -----------------------
      - size: small
        widgets:

          # https://github.com/glanceapp/community-widgets/blob/main/widgets/unifi/README.md        

          - type: custom-api
            title: Unifi
            cache: 1m
            allow-insecure: true
            url: https://${UNIFI_CONSOLE_IP}/proxy/network/api/stat/sites
            headers:
              X-API-KEY: ${UNIFI_API_KEY}
              Accept: application/json
            template: | 
              <style>
                .list-horizontal-text.no-bullets-unifi > *:not(:last-child)::after {
                    content: none !important;
                }
                .list-horizontal-text.no-bullets-unifi > *:not(:last-child) {
                  margin-right: 1em;
                }
              </style>
              {{ range .JSON.Array "data" }}
                <div style="display:flex; align-items:center; gap:12px;">
                  <div style="width:40px; height:40px; flex-shrink:0; display:flex; justify-content:center; align-items:center; overflow:hidden;">
                    <img src="https://cdn.jsdelivr.net/gh/selfhst/icons/svg/ubiquiti-unifi-light.svg" width="24" height="24" style="object-fit:contain;">
                  </div>
                  <div style="flex-grow:1; min-width:0;">
                    <a class="size-h4 block text-truncate color-highlight">
                      {{ .String "health.#(subsystem=\"wan\").gw_name" }}
                      {{ if eq (.String "health.#(subsystem=\"wan\").status") "ok" }}
                      <span
                        style="width: 8px; height: 8px; border-radius: 50%; background-color: var(--color-positive); display: inline-block; vertical-align: middle;"
                        data-popover-type="text"
                        data-popover-text="WAN Connected"
                      ></span>
                      {{ else }}
                      <span
                        style="width: 8px; height: 8px; border-radius: 50%; background-color: var(--color-negative); display: inline-block; vertical-align: middle;"
                        data-popover-type="text"
                        data-popover-text="WAN Disconnected"
                      ></span>
                      {{ end }}
                    </a>
                    <ul class="list-horizontal-text no-bullets-unifi">
                      <li data-popover-type="text" data-popover-text="Uptime: {{ printf "%.1f" (div (.Float "health.#(subsystem=\"wan\").gw_system-stats.uptime") 86400) }} Days">
                        <p style="display:inline-flex;align-items:center;">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122.88 99.54" fill="currentColor" stroke="currentColor" stroke-width="0"  class="size-6" style="height:1em;vertical-align:middle;margin-right:0.5em;">
                              <path d="M73.12,0c6.73,0,13.16,1.34,19.03,3.77c6.09,2.52,11.57,6.22,16.16,10.81l0,0c4.58,4.58,8.28,10.06,10.8,16.17 c2.43,5.87,3.77,12.3,3.77,19.02c0,6.73-1.34,13.16-3.77,19.03c-2.52,6.09-6.22,11.57-10.81,16.16l0,0 c-4.58,4.58-10.06,8.28-16.17,10.8c-5.87,2.43-12.3,3.77-19.02,3.77c-6.73,0-13.16-1.34-19.03-3.77 c-6.09-2.52-11.57-6.22-16.15-10.8l-0.01-0.01c-4.59-4.59-8.28-10.07-10.8-16.15c-0.78-1.89-1.45-3.83-2-5.82 c1.04,0.1,2.1,0.15,3.17,0.15c2.03,0,4.01-0.18,5.94-0.53c0.32,0.96,0.67,1.91,1.05,2.84c2.07,5,5.11,9.5,8.89,13.28 c3.78,3.78,8.29,6.82,13.28,8.89c4.81,1.99,10.1,3.1,15.66,3.1s10.84-1.1,15.66-3.1c5-2.07,9.5-5.11,13.28-8.89 c3.78-3.78,6.82-8.29,8.89-13.28c1.99-4.81,3.1-10.1,3.1-15.66s-1.1-10.84-3.1-15.66c-2.07-5-5.11-9.5-8.89-13.28 s-8.29-6.82-13.28-8.89c-4.81-1.99-10.1-3.1-15.66-3.1s-10.84,1.1-15.66,3.1c-0.43,0.18-0.86,0.37-1.28,0.56 c-1.64-2.58-3.62-4.92-5.89-6.95c1.24-0.64,2.51-1.23,3.8-1.77C59.97,1.34,66.39,0,73.12,0L73.12,0L73.12,0z M67.41,26.11 c0-1.22,0.5-2.32,1.29-3.12c0.8-0.8,1.9-1.29,3.12-1.29c1.22,0,2.32,0.49,3.12,1.29c0.8,0.8,1.29,1.9,1.29,3.12v23.22l17.35,10.29 c1.04,0.62,1.74,1.61,2.02,2.7c0.28,1.09,0.15,2.29-0.47,3.33v0.01l0,0c-0.62,1.04-1.61,1.74-2.7,2.02s-2.29,0.15-3.33-0.47h-0.01 l0,0L69.68,55.7c-0.67-0.37-1.22-0.91-1.62-1.55c-0.41-0.67-0.65-1.46-0.65-2.3V26.11L67.41,26.11L67.41,26.11z"/>
                              <path style="fill-rule:evenodd; clip-rule:evenodd;" d="M26.98,2.64c14.9,0,26.98,12.08,26.98,26.98c0,14.9-12.08,26.98-26.98,26.98S0,44.52,0,29.62 C0,14.72,12.08,2.64,26.98,2.64L26.98,2.64L26.98,2.64z M26.98,13.72l14.48,17.9h-8.99v9.52H21.49v-9.52H12.5L26.98,13.72 L26.98,13.72z"/>
                          </svg>
                          {{ printf "%.1f" (div (.Float "health.#(subsystem=\"wan\").gw_system-stats.uptime") 86400) }}
                        </p>
                      </li>
                      <li data-popover-type="text" data-popover-text="Wired clients: {{ .Int "health.#(subsystem=\"lan\").num_user" }}">
                        <p style="display:inline-flex;align-items:center;">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0"  class="size-6" style="height:1em;vertical-align:middle;margin-right:0.5em;">
                            <path fill="none" d="M0 0h24v24H0z"></path><path d="M7.77 6.76 6.23 5.48.82 12l5.41 6.52 1.54-1.28L3.42 12l4.35-5.24zM7 13h2v-2H7v2zm10-2h-2v2h2v-2zm-6 2h2v-2h-2v2zm6.77-7.52-1.54 1.28L20.58 12l-4.35 5.24 1.54 1.28L23.18 12l-5.41-6.52z"></path>
                          </svg>
                          {{ .Int "health.#(subsystem=\"lan\").num_user" }}
                        </p>
                      </li>
                      <li data-popover-type="text" data-popover-text="Wireless clients: {{ .Int "health.#(subsystem=\"wlan\").num_user" }}">
                        <p style="display:inline-flex;align-items:center;">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0"  class="size-6" style="height:1em;vertical-align:middle;margin-right:0.5em;">
                            <path d="M12 6c3.537 0 6.837 1.353 9.293 3.809l1.414-1.414C19.874 5.561 16.071 4 12 4c-4.071.001-7.874 1.561-10.707 4.395l1.414 1.414C5.163 7.353 8.463 6 12 6zm5.671 8.307c-3.074-3.074-8.268-3.074-11.342 0l1.414 1.414c2.307-2.307 6.207-2.307 8.514 0l1.414-1.414z"></path><path d="M20.437 11.293c-4.572-4.574-12.301-4.574-16.873 0l1.414 1.414c3.807-3.807 10.238-3.807 14.045 0l1.414-1.414z"></path><circle cx="12" cy="18" r="2"></circle>
                          </svg>
                          {{ .Int "health.#(subsystem=\"wlan\").num_user"  }}
                        </p>
                      </li>
                    </ul>
                  </div>
                </div>
              {{ end }}

# https://github.com/glanceapp/glance/blob/main/docs/configuration.md#server-stats

          - type: server-stats
            servers:
              - type: local
                hide-mountpoints-by-default: true
                mountpoints:
                  "/":
                    hide: false
                  "/mnt/data":
                    hide: false

# https://github.com/glanceapp/community-widgets/blob/main/widgets/tailscale-devices/README.md

          - type: custom-api
            title: Tailscale Devices
            title-url: https://login.tailscale.com/admin/machines
            url: https://api.tailscale.com/api/v2/tailnet/-/devices
            headers:
              Authorization: Bearer ${TAILSCALE_API_KEY}
            cache: 10m
            template: |
              {{/* User Variables */}}
              {{/* Set to true if you'd like an indicator for online devices */}}
              {{ $enableOnlineIndicator := false }}

              <style>
                .device-info-container {
                  position: relative;
                  overflow: hidden;
                  height: 1.5em;
                }

                .device-info {
                  display: flex;
                  transition: transform 0.2s ease, opacity 0.2s ease;
                }

                .device-ip {
                  position: absolute;
                  top: 0;
                  left: 0;
                  transform: translateY(-100%);
                  opacity: 0;
                  transition: transform 0.2s ease, opacity 0.2s ease;
                }

                .device-info-container:hover .device-info {
                  transform: translateY(100%);
                  opacity: 0;
                }

                .device-info-container:hover .device-ip {
                  transform: translateY(0);
                  opacity: 1;
                }

                .update-indicator {
                  width: 8px;
                  height: 8px;
                  border-radius: 50%;
                  background-color: var(--color-primary);
                  display: inline-block;
                  margin-left: 4px;
                  vertical-align: middle;
                }

                .offline-indicator {
                  width: 8px;
                  height: 8px;
                  border-radius: 50%;
                  background-color: var(--color-negative);
                  display: inline-block;
                  margin-left: 4px;
                  vertical-align: middle;
                }

                .online-indicator {
                  width: 8px;
                  height: 8px;
                  border-radius: 50%;
                  background-color: var(--color-positive);
                  display: inline-block;
                  margin-left: 4px;
                  vertical-align: middle;
                }

                .device-name-container {
                  display: flex;
                  align-items: center;
                  gap: 8px;
                }

                .indicators-container {
                  display: flex;
                  align-items: center;
                  gap: 4px;
                }
              </style>
              <ul class="list list-gap-10 collapsible-container" data-collapse-after="4">
                {{ range .JSON.Array "devices" }}
                <li>
                  <div class="flex items-center gap-10">
                    <div class="device-name-container grow">
                      <span class="size-h4 block text-truncate color-primary">
                        {{ findMatch "^([^.]+)" (.String "name") }}
                      </span>
                      <div class="indicators-container">
                        {{ if (.Bool "updateAvailable") }}
                        <span class="update-indicator" data-popover-type="text" data-popover-text="Update Available"></span>
                        {{ end }}

                        {{ $lastSeen := .String "lastSeen" | parseTime "rfc3339" }}
                        {{ if not ($lastSeen.After (offsetNow "-10s")) }}
                        {{ $lastSeenTimezoned := $lastSeen.In now.Location }}
                        <span class="offline-indicator" data-popover-type="text"
                          data-popover-text="Offline - Last seen {{ $lastSeenTimezoned.Format " Jan 2 3:04pm" }}"></span>
                        {{ else if $enableOnlineIndicator }}
                          <span class="online-indicator" data-popover-type="text" data-popover-text="Online"></span>
                        {{ end }}
                      </div>
                    </div>
                  </div>
                  <div class="device-info-container">
                    <ul class="list-horizontal-text device-info">
                      <li>{{ .String "os" }}</li>
                      <li>{{ .String "user" }}</li>
                    </ul>
                    <div class="device-ip">
                      {{ .String "addresses.0"}}
                    </div>
                  </div>
                </li>
                {{ end }}
              </ul>



      # -----------------------
      # FULL COLUMN
      # -----------------------
      - size: full
        widgets:

          # https://github.com/glanceapp/glance/blob/main/docs/configuration.md#docker-containers

          - type: docker-containers
            containers:
              container_name_1:
                name: Container Name
                description: Description of the container
                url: https://container.domain.com
                icon: si:container-icon
                hide: false        


          # https://github.com/glanceapp/glance/blob/main/docs/configuration.md#reddit

          - type: group
            define: &shared-properties
                type: reddit
                show-thumbnails: true
                collapse-after: 5
            widgets:
              - subreddit: selfhosted
                <<: *shared-properties
              - subreddit: docker
                <<: *shared-properties
              - subreddit: homelab
                <<: *shared-properties



      # -----------------------
      # SMALL COLUMN
      # -----------------------
      - size: small
        widgets:

          # https://github.com/glanceapp/community-widgets/blob/main/widgets/speedtest-tracker/README.md

          - type: custom-api
            cache: 1h
            title: Internet Speed
            title-url: ${SPEEDTEST_URL}
            url: ${SPEEDTEST_URL}/api/v1/results/latest
            headers:
              Authorization: Bearer ${SPEEDTEST_TRACKER_API_TOKEN}
              Accept: application/json
            subrequests:
              stats:
                url: ${SPEEDTEST_URL}/api/v1/stats
                headers:
                  Authorization: Bearer ${SPEEDTEST_TRACKER_API_TOKEN}
                  Accept: application/json
            options:
              showPercentageDiff: true
            template: |
              {{ $showPercentage := .Options.BoolOr "showPercentageDiff" true }}

              {{ $stats := .Subrequest "stats" }}
              <div class="flex justify-between text-center margin-block-3">
              <div>
                  {{ $downloadChange := percentChange ($stats.JSON.Float "data.download.avg_bits") (.JSON.Float "data.download_bits")
                  }}
                  {{ if $showPercentage }}
                  <div
                  class="size-small {{ if gt $downloadChange 0.0 }}color-positive{{ else if lt $downloadChange 0.0 }}color-negative{{ else }}color-primary{{ end }}"
                  style="display: inline-flex; align-items: center;">
                  {{ $downloadChange | printf "%+.1f%%" }}
                  {{ if gt $downloadChange 0.0 }}
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                      style="height: 1em; margin-left: 0.25em;" class="size-4">
                      <path fill-rule="evenodd"
                      d="M9.808 4.057a.75.75 0 0 1 .92-.527l3.116.849a.75.75 0 0 1 .528.915l-.823 3.121a.75.75 0 0 1-1.45-.382l.337-1.281a23.484 23.484 0 0 0-3.609 3.056.75.75 0 0 1-1.07.01L6 8.06l-3.72 3.72a.75.75 0 1 1-1.06-1.061l4.25-4.25a.75.75 0 0 1 1.06 0l1.756 1.755a25.015 25.015 0 0 1 3.508-2.85l-1.46-.398a.75.75 0 0 1-.526-.92Z"
                      clip-rule="evenodd" />
                  </svg>
                  {{ else if lt $downloadChange 0.0 }}
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                      style="height: 1em; margin-left: 0.25em;" class="size-4">
                      <path fill-rule="evenodd"
                      d="M1.22 4.22a.75.75 0 0 1 1.06 0L6 7.94l2.761-2.762a.75.75 0 0 1 1.158.12 24.9 24.9 0 0 1 2.718 5.556l.729-1.261a.75.75 0 0 1 1.299.75l-1.591 2.755a.75.75 0 0 1-1.025.275l-2.756-1.591a.75.75 0 1 1 .75-1.3l1.097.634a23.417 23.417 0 0 0-1.984-4.211L6.53 9.53a.75.75 0 0 1-1.06 0L1.22 5.28a.75.75 0 0 1 0-1.06Z"
                      clip-rule="evenodd" />
                  </svg>
                  {{ end }}
                  </div>
                  {{ end }}
                  <div class="color-highlight size-h3">{{ .JSON.Float "data.download_bits" | mul 0.000001 | printf "%.1f" }}</div>
                  <div class="size-h6">DOWNLOAD</div>
              </div>
              <div>
                  {{ $uploadChange := percentChange ($stats.JSON.Float "data.upload.avg_bits") (.JSON.Float "data.upload_bits") }}
                  {{ if $showPercentage }}
                  <div
                  class="size-small {{ if gt $uploadChange 0.0 }}color-positive{{ else if lt $uploadChange 0.0 }}color-negative{{ else }}color-primary{{ end }}"
                  style="display: inline-flex; align-items: center;">
                  {{ $uploadChange | printf "%+.1f%%" }}
                  {{ if gt $uploadChange 0.0 }}
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                      style="height: 1em; margin-left: 0.25em;" class="size-4">
                      <path fill-rule="evenodd"
                      d="M9.808 4.057a.75.75 0 0 1 .92-.527l3.116.849a.75.75 0 0 1 .528.915l-.823 3.121a.75.75 0 0 1-1.45-.382l.337-1.281a23.484 23.484 0 0 0-3.609 3.056.75.75 0 0 1-1.07.01L6 8.06l-3.72 3.72a.75.75 0 1 1-1.06-1.061l4.25-4.25a.75.75 0 0 1 1.06 0l1.756 1.755a25.015 25.015 0 0 1 3.508-2.85l-1.46-.398a.75.75 0 0 1-.526-.92Z"
                      clip-rule="evenodd" />
                  </svg>
                  {{ else if lt $uploadChange 0.0 }}
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                      style="height: 1em; margin-left: 0.25em;" class="size-4">
                      <path fill-rule="evenodd"
                      d="M1.22 4.22a.75.75 0 0 1 1.06 0L6 7.94l2.761-2.762a.75.75 0 0 1 1.158.12 24.9 24.9 0 0 1 2.718 5.556l.729-1.261a.75.75 0 0 1 1.299.75l-1.591 2.755a.75.75 0 0 1-1.025.275l-2.756-1.591a.75.75 0 1 1 .75-1.3l1.097.634a23.417 23.417 0 0 0-1.984-4.211L6.53 9.53a.75.75 0 0 1-1.06 0L1.22 5.28a.75.75 0 0 1 0-1.06Z"
                      clip-rule="evenodd" />
                  </svg>
                  {{ end }}
                  </div>
                  {{ end }}
                  <div class="color-highlight size-h3">{{ .JSON.Float "data.upload_bits" | mul 0.000001 | printf "%.1f" }}</div>
                  <div class="size-h6">UPLOAD</div>
              </div>
              <div>
                  {{ $pingChange := percentChange ($stats.JSON.Float "data.ping.avg") (.JSON.Float "data.ping") }}
                  {{ if $showPercentage }}
                  <div
                  class="size-small {{ if gt $pingChange 0.0 }}color-negative{{ else if lt $pingChange 0.0 }}color-positive{{ else }}color-primary{{ end }}"
                  style="display: inline-flex; align-items: center;">
                  {{ $pingChange | printf "%+.1f%%" }}
                  {{ if lt $pingChange 0.0 }}
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                      style="height: 1em; margin-left: 0.25em;" class="size-4">
                      <path fill-rule="evenodd"
                      d="M1.22 4.22a.75.75 0 0 1 1.06 0L6 7.94l2.761-2.762a.75.75 0 0 1 1.158.12 24.9 24.9 0 0 1 2.718 5.556l.729-1.261a.75.75 0 0 1 1.299.75l-1.591 2.755a.75.75 0 0 1-1.025.275l-2.756-1.591a.75.75 0 1 1 .75-1.3l1.097.634a23.417 23.417 0 0 0-1.984-4.211L6.53 9.53a.75.75 0 0 1-1.06 0L1.22 5.28a.75.75 0 0 1 0-1.06Z"
                      clip-rule="evenodd" />
                  </svg>
                  {{ else if gt $pingChange 0.0 }}
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                      style="height: 1em; margin-left: 0.25em;" class="size-4">
                      <path fill-rule="evenodd"
                      d="M9.808 4.057a.75.75 0 0 1 .92-.527l3.116.849a.75.75 0 0 1 .528.915l-.823 3.121a.75.75 0 0 1-1.45-.382l.337-1.281a23.484 23.484 0 0 0-3.609 3.056.75.75 0 0 1-1.07.01L6 8.06l-3.72 3.72a.75.75 0 1 1-1.06-1.061l4.25-4.25a.75.75 0 0 1 1.06 0l1.756 1.755a25.015 25.015 0 0 1 3.508-2.85l-1.46-.398a.75.75 0 0 1-.526-.92Z"
                      clip-rule="evenodd" />
                  </svg>
                  {{ end }}
                  </div>
                  {{ end }}
                  <div class="color-highlight size-h3">{{ .JSON.Float "data.ping" | printf "%.0f ms" }}</div>
                  <div class="size-h6">PING</div>
              </div>
              </div>
              
          # https://github.com/glanceapp/glance/blob/main/docs/configuration.md#releases
          - type: releases
            hide-header: true
            cache: 1d
            show-source-icon: true
            token: ${GITHUB_TOKEN}
            collapse-after: 10
            limit: 25
            repositories:
              - go-gitea/gitea
              - jellyfin/jellyfin
              - glanceapp/glance
              - codeberg:redict/redict
              - gitlab:fdroid/fdroidclient
              - dockerhub:gotify/server
